{{#template name="tutorials.socially.angular1.step_07.md"}}
{{> downloadPreviousStep stepName="step_06"}}

Отлично, теперь у нас есть работающее приложение, но пока оно не хорошо организовано.

Очень правильно с самого начала организовать ваше приложение стандартным образом и в Meteor, структура имеет значение и использование.

На этом шаге, мы скомбинируем стандартные способы In this step, we are going to combine Meteor's и Angular 1's standard ways of structuring an app into one unified standard structure.


# Структура папок Meteor

Из сайта `docs.meteor.com`:

> Meteor приложение - это смесь JavaScript, которая запускается всередине клиентского браузреа, JavaScript, который запускается всередине сервера Meteor всередине контейнера Node.js и все поддерживающие HTML фрагменты, CSS правила и стачические объекты.
> Meteor автоматизирует пакетирование и преедачу этих разных компонентов. И, он достаточно гибок насчёт того, как вы структурируете эти все компоненты в вашем дереве файлов.
>
> Файлы вне поддиректорий **client**, **server** и **tests** загружаются в клиенте и сервере!
> Это место для определения модели и других функций.
>
> Файлы CSS собраны вместе: клиент получит связку со всем и CSS в вашем дереве (исключая server, public, и private поддиректории).
>
> В режиме разработки JavaScript и CSS файлы отправляются отдельно для облегчения отладки.

## Порядок загрузки

Лучше написать наше приложение таким образом, чтобы оно было нечувствительно к порядку, в котором загружаются файлы. Это может быть достигнуто, например, использованием Meteor.startup или передвиженим чувствительного к порядку загрузки кода в пакеты, что может дать избыточный контроль над порядком загрузки их содержимого и их порядка загрузки исходя из других пакетов.
Тем не менее, иногда использование зависимостей порядка загрузки неизбежно в вашем приложении.

Файлы JavaScript и CSS в приложении загружаются исходя из этих правил:

### server

Meteor собирает любые файлы в поддиректории **private** и делает содержимое этих файлов доступным к серверному коду через Assets API. Поддиректория **private** - это место для любых файлов, к которым нужно иметь доступ к серверному коду, но не должны отдаваться клиенту, как приватные файлы данных.

Любой чувствительный код, который вы не хотите передавать на клиент, такой как, например, пароли и механизмы авторизации, должны содержаться в директории server.

### client

Файлы, всередине **client** папки должны запускаться только на клиенте.

Есть больше аспектов, которые необходимо принять во внимание на клиентской стороне. Meteor собирает все JavaScript файлы в вашем дереве, за исключением server, public и private поддиректорий для клиента. Он минифицирует эту сборку и отправляет её каждому новому клиенту. У вас есть полная свобода использовать один JavaScript файл во всём приложении или создать сложное дерево отдельных файлов или что-то типа того.

### public

Наконец, Meteor сервер обслуживает любые файлы в папке public. Это место для изображений, favicon.ico, robots.txt и всего остального.

### Больше правил

* Файлы в поддиректориях загружаются перед файлами в родительских директориях, поэтому файлы в самых глубоких папках загружаются первыми и файлы в корневой папке загружаются последними.
* Всередине папки файлы загружаются в алфавитном порядке по названию файла.
* После сортировку описаной выше, все файлы в папках под названием **lib** помещаются в самый перёд (сохраняя порядок).
* Наконец, все файлы, которые соответствуют main.* шаблону перемещаются  в конец после всех остальных (сохраняя их порядок).


# Структура папок Angular 1

Есть много способов организации и структурирования приложения Angular 1.

Два основных подхода это:

* Сортировка по типу файла (контроллеры, отображения и др.)
* Сортировка по функциональности (пользователи, вечеринки, товары и др.)

Первый подход хорошо работает в маленьких приложениях и входит в текущую структуру [yeoman-angular-generator](https://github.com/yeoman/generator-angular).

Второй подход лучше работает в больших приложениях.

Мы работает вместе с коллекциями Meteor и думаю, что лучший подход основан на функциональности, который также коллерирует со структурой коллекций Meteor.

Для большего структурирования Angular 1 и лучших практик, пожалуйста, прочтите этот отличный [style-guide](https://github.com/johnpapa/angularjs-styleguide#application-structure) и для лучших практик для Meteor приложений читайте [официальное руководство](http://guide.meteor.com/).

# Реструктурирование нашего приложения

Давайте реструктурируем наше приложение (чтобы увидеть окончательный результат и все изменения в гите, можете кликнуть [здесь](https://github.com/Urigo/meteor-angular-socially/compare/step_06...step_07)):

1. Создайте папку с именем `client` в корне. Здесь будет размещён весь код для `Meteor.isClient` (поэтому не нужно будет писать больше Meteor.isClient)
2. Первой вещью, которая загрузится - это папка `client` с описанием Angular 1 приложения. После этого весь остальной клиентский код может быть загружен в любом порядке. Поэтому создайте папку `lib` всередине клиентской папки `client` и создайте файл `app.js` всередине. Всё всередине папки `client` будет запускаться только в браузере, поэтому нам не нужно больше использовать условие `if (Meteor.isClient)`. Поместите декларирование модуля Angular в этот `app.js`:
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.1"}}
3. Коллекция вечеринок Mongo должна запускаться на клиенте и сервере. Создайте папку с названием `model` в корневой папке. Всередине создайте файл с названием `parties.js` и вырежте строку из `app.js` - `Parties = new Mongo.Collection("parties");` - и поместите её в `parties.js`.
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.2"}}
4. Создайте папку `server` в корневой папке. Всё всередине этой папки будет запускаться только на сервере. Теперь создайте папку с названием `startup` в папке `server`. Теперь переместите `server.js` в эту папку и переименуйте её на `loadParties.js`. Теперь уберите `if (Meteor.isServer)` выражение, так как нет нужды для выражения if более, так как весь код всередине папки `server` запускается только на сервере.
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.3"}}
5. Создайте файл `routes.js` в папке `client`. Вырежте код `.config`, который определяет маршруты и вставьте его всередине этого файла.
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.4"}}
6. Создайте папку `parties` всередине `client`. И создайте в ней две папки - по одной для каждого нашего компонента, одну назовите `parties-list` и вторую `party-details`.
7. Создайте новый файл всередине папки `client/parties/parties-list` с названием `parties-list.component.js`. Вырежте код для `partiesList` компонента от `app.js` и поместите его туда.
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.5"}}
8. Теперь переместите `parties-list.html` в `client/parties/parties-list`.
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.6"}}
9. Создайте новый файл всередине папки `client/parties/party-details` с названием  `party-details.component.js`. Вырежте код для компонента `partyDetails` из `app.js` и поместите его туда.
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.7"}}
10. Теперь поместите `party-details.html` в `client/parties/party-details`.
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.8"}}
11. Нам нужно обновить  `templateUrl` в наших компонентах для поддержки нового путя, потому что эти пути абсолютны, а не относительны:
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.9" filename="client/parties/parties-list/parties-list.component.js"}}
{{> DiffBox tutorialName="meteor-angular1-socially" step="7.9" filename="client/parties/party-details/party-details.component.js"}}
13. Поместите `index.html` всередине клиентской папки.
14. Не забудьте удалить оригинальные файлы `app.js` из корня проекта.

Как видите, всё работало так, как и ранее.
Нам не нужно менять любые ссылки в `index.html` как в других фреймворках, Метеор позаботиться об этом сам.

{{/template}}