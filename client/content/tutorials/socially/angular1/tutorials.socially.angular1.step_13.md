{{#template name="tutorials.socially.angular1.step_13.md"}}
{{> downloadPreviousStep stepName="step_12"}}

Следующа наша задача - пригласить пользователей на частные вечеринки.

Мы подписалиcь к списку всех пользоватлей, но мы никого не пригласили.
Мы можем пригласить владельца вечеринки и мы не можем пригласить пользователей, которые уже приглашены, почему не отфильтровать это в нашем отображении?

Чтобы сделать это исопльзуем мощную [фильтр фичу](https://docs.angularjs.org/guide/filter) в Angular 1.

Фильтры могут работать на массивах, так и на просто переменных.
Мы можем включать любое количество фильтров над каждым.

Вот список встроенных в Angular 1 фильтров:
[https://docs.angularjs.org/api/ng/filter](https://docs.angularjs.org/api/ng/filter)

И вот библиотека 3ей стороны с ещё большим количеством фильтров:
[angular-filter](https://github.com/a8m/angular-filter)


Давайте создадим пользовательский фильтр, который отфильтрует пользователей, которые являются владельцами соответствующей вечеринки и уже приглашены к ней.

Создайте новую папку `filters` в папке `client->parties`.

В этой папке создайте новый файл `uninvited.js` и поместите туда этот код:

{{> DiffBox tutorialName="meteor-angular1-socially" step="13.1"}}

* Во-первых мы определили фильтр в модуле 'socially' (наше приложение)
* Фильтр называется `uninvited`
* Фильтры всегда получают минимум один параметр и первый параметр всегда объект или массив, который мы фильтруем (как другие вечеринки в предыдущем примере)
Здесь мы фильтруем пользовательский массив, поэтому это первый параметр
* Второй параметр - это вечеринка, которую нам нужно проверить
* Первый if оператор - проверяем передали мы инициализирующую фазу вечеринки или она undefined

В этом моменте нам нужно вернуть отфильтрованный массив.

Отличной вещью здесь есть то, что благодаря Meteor у нас есть доступ к отличной библиотеке [underscore](http://docs.meteor.com/#underscore).

Поэтому мы будем использовать underscore метод `filter` для удаления каждого пользователя, который не является владельцем вечеринки или уже не находится `_contains` (другой метод underscore) в списке приглашённых.

Давайте используем новый фильтр

Просто добавьте фильтр к списку пользователей и отправьте текущую вечеринку в параметре вечеринки всередине `party-details.html`:

{{> DiffBox tutorialName="meteor-angular1-socially" step="13.2"}}

Запустите приложение и посмотрите на пользователей в каждой из них.

У нас по-прежнему нет приглашений, но как видите фильтр уже фильтрует владельцев вечеринок вне списка.

Но у некоторых пользователей нет email (наверное некоторые из низ подписались с помощью Facebook). В этом случае мы хотели бы выводить их имена, а не пустые email поля.

Но это только при выводя, поэтому идеально подходит для фильтра.

Мы хотим, чтобы список просто выглядел так:

{{> DiffBox tutorialName="meteor-angular1-socially" step="13.4"}}

и фильтр с именем `displayName` будет содержать логику и выводить имена пользователей в наилучшем виде.

Давайте создадим ещё один кастомный фильтр `displayName`.

Создайте новый файл в папке фильтров под именем `displayName.js` и разместите код внутри:

{{> DiffBox tutorialName="meteor-angular1-socially" step="13.3"}}

Очень простая логика, но было бы лучше включить его здесь и сделать HTML короче и более читаемым.

AngularJS может также выводить и возвращать значения функций в HTML.

Для демонстрации добавим к каждой вечеринке в списке имя её создателя:

Добавьте строку, которая выводит пользовательскую информацию о списке в `parties-list.html`, она будет выглядеть так:

{{> DiffBox tutorialName="meteor-angular1-socially" step="13.5"}}

Определите функцию `getPartyCreator` в компоненте `partiesList`:

{{> DiffBox tutorialName="meteor-angular1-socially" step="13.6"}}

Как видите, мы используем коллекцию `Meteor.users` здесь, но мы не убедились, что мы подписаны к ней 
(Если бы мы посетили контроллер `partyDetails` перед этим, тогда бы контроллер `partyDetails` бы подписал на коллекцию Meteor.users, но если бы мы не были там, то получили бы пустой массив в Meteor.users).

Добавим подписку к пользователям `users` в списке компонентов:

{{> DiffBox tutorialName="meteor-angular1-socially" step="13.7"}}

Получим пользовательский объект в HTML. Нам нужно также его имя, поэтому добавим фильтр `displayName` в него:

{{> DiffBox tutorialName="meteor-angular1-socially" step="13.8"}}

# Итоги

В этой части мы познакомились с фильтрами Angular 1 и узнали как легки они в использовании и чтении из HTML.

На следующем этапе мы познакомимся с методами Meteor, которые позволяют запускать кастомную логику в сервере, над Mongo API и методами allow/deny.

{{/template}}
